@model IEnumerable<TechInvMgmt.Models.Inventory>
@inject TechInvMgmt.Data.ApplicationDbContext context
@{
    ViewData["Title"] = "Replenish";
    List<Subinventory> subinventories = await TechInvMgmt.Data.SubinventoryDb.GetSubinvParts(context);
    List<Part> parts = await TechInvMgmt.Data.PartDb.GetPartsAsync(context);

    bool alternateRowColor = true;
    var RowColor_Subinv = "80558c";
    var RowColor_Part = "ccac88";
    var RowColor_Qty = "989898";
    var everyOtherRowColor_Subinv = "93739c";
    var everyOtherRowColor_Part = "d2bba2";
    var everyOtherRowColor_Qty = "a7a7a7";
    var bgColor_Subinv = "";
    var bgColor_Part = "";
    var bgColor_Qty = "";
}

@if (TempData["Message"] != null)
{
    <div class="alert alert-success alert-dismissible" role="alert">@TempData["Message"]</div>
}

<div class="nav justify-content-center" style="width: 100%; text-align:center;padding-bottom:1%;">
    <h1 id="header" class="tablePageHeader">Replenish</h1>
    <select class="searchDropdown" id="search" style="width:180px;text-align:center;margin:auto;">
        <option selected disabled>Select Subinventory</option>
        @foreach (Subinventory s in subinventories)
        {
            <option value="@s.SubinventoryId">@s.ToString()</option>
        }
    </select>
</div>

<div>
    <div class="dropdown-toggle" href="#" style="float:left;">
        <a class="nav-link hvr-sweep-to-right" data-toggle="collapse" data-target="#mySearch" style="padding:5px;text-align:center;background-color:#ffffff99;"><img class="nav-icon" src="~/img/Search.png" style="height:25px;" /> </a>
    </div>
    <ul class="collapse" id="mySearch" style="margin-bottom:0px;float:left;list-style-type:none;padding:0;">
        <li>
            <input id="mySearchInput" placeholder="Search table" onkeyup="mySearchFilter()" style="text-align:center;background-color:#ffffff99;height:35px;border:none;" />
        </li>
    </ul>
</div>

<table class="table myTables" id="indexTable" style="text-align:center;background-color:white;margin: 0 auto;">
    <thead>
        <tr>
            <th style="width:33%;">
                @Html.DisplayNameFor(model => model.SubinventoryId)
            </th>
            <th style="width:33%;">
                @Html.DisplayNameFor(model => model.PartId)
            </th>
            <th style="width:33%;">
                Qty
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            if (alternateRowColor)
            {
                alternateRowColor = false;
                bgColor_Subinv = RowColor_Subinv;
                bgColor_Part = RowColor_Part;
                bgColor_Qty = RowColor_Qty;
            }
            else
            {
                alternateRowColor = true;
                bgColor_Subinv = everyOtherRowColor_Subinv;
                bgColor_Part = everyOtherRowColor_Part;
                bgColor_Qty = everyOtherRowColor_Qty;
            }
            if (item.SubinventoryId != "WHS")
            {
                <tr class="hvr-forward">
                    <td style="background-color:#@bgColor_Subinv;">
                        <a class="btn" asp-action="Edit" asp-route-id="@item.InventoryId" style="width:100%;color:wheat;">
                            @Html.DisplayFor(modelItem => item.SubinventoryId)
                        </a>
                    </td>
                    <td style="background-color: #@bgColor_Part;">
                        <a class="btn" asp-action="Edit" asp-route-id="@item.InventoryId" style="width:100%;">
                            @Html.DisplayFor(modelItem => item.PartId)
                        </a>
                    </td>
                    <td style="background-color:#@bgColor_Qty;">
                        <a class="btn" asp-action="Edit" asp-route-id="@item.InventoryId" style="width:100%;font-size: 1rem;color:wheat;">
                            @foreach (var p in parts)
                            {
                                if (item.PartId == p.PartId)
                                {
                                    int replenishQty = p.RemoteBaseStock - item.Quantity;
                                    <div>@replenishQty</div>
                                }
                            }
                        </a>
                    </td>
                </tr>
            }
        }
    </tbody>
</table>

<script>
    var searchValue = document.getElementById("search");
    var listOfRows = document.querySelectorAll("tr");

    // hide all rows to begin
    for (var i = listOfRows.length - 1; i > 0; i--) {
        listOfRows[i].style.display = "none";
    }

    // whenever search box is changed
    searchValue.onchange = function () {
        // check the user input
        console.log("USER INPUT: " + searchValue.value.trim());
        // make sure each row is displaying
        for (var i = listOfRows.length - 1; i > 0; i--) {
            listOfRows[i].style.display = "table-row";
        }
        // hide each row that does NOT contain the user input
        for (var i = listOfRows.length - 1; i > 0; i--) {
            if (listOfRows[i].firstChild.nextSibling.firstChild.nextSibling.textContent.trim() != searchValue.value.toUpperCase().trim()) {
                listOfRows[i].style.display = "none";
            }
        }
    };

    document.body.style.backgroundImage = "url(/img/CementFloorbg.jpg)";
    document.body.style.backgroundPosition = "center";
    document.body.style.backgroundSize = "cover";

    // Alternate table row color
    var numOfCellsToIterateBy = 6; // numOfColumns * 2
    var tableCells = document.querySelectorAll("td");
    for (var i = 3; i < tableCells.length; i += numOfCellsToIterateBy) {
        tableCells[i].style.background = "#93739c";
        tableCells[i + 1].style.background = "#d2bba2";
        tableCells[i + 2].style.background = "#a7a7a7";
    }

    var listOfRows = document.querySelectorAll("tr");

    // Search all table cells
    // function triggers onkeyup
    function mySearchFilter() {
        // Make sure all rows are displaying
        for (var i = 0; i < listOfRows.length; i++) {
            listOfRows[i].style.display = "table-row";
        }
        // Filter out unmatching rows
        var mySearchInput = document.getElementById("mySearchInput").value;
        for (var i = 1; i < listOfRows.length; i++) {
            var rowContent = listOfRows[i].innerText.trim();
            if (!rowContent.includes(mySearchInput.toUpperCase())) {
                listOfRows[i].style.display = "none";
            }
        }
        if (mySearchInput == "") {
            pagination();
        }
    }
</script>
